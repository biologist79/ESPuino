<!DOCTYPE html>
<html lang="de">
<head>
	<title data-i18n="title">ESPuino-Settings</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="shortcut icon" type="image/x-icon" href="/favicon">
	<link rel="stylesheet" href="https://espuino.de/espuino/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/themes/default/style.min.css"/>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"/>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css"/>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/11.0.2/css/bootstrap-slider.min.css" />
	<script src="https://espuino.de/espuino/js/jquery.min.js"></script>
	<script src="https://code.jquery.com/ui/1.12.0/jquery-ui.min.js"></script>
	<script src="https://espuino.de/espuino/js/popper.min.js"></script>
	<script src="https://espuino.de/espuino/js/bootstrap.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/jstree.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/11.0.2/bootstrap-slider.min.js"></script>
    
    <script src="/js/i18next.min.js"></script>
    <script src="/js/i18nextHttpBackend.min.js"></script>
    <script src="/js/loc_i18next.min.js"></script>
	<style type="text/css">
		.filetree {
			border: 1px solid black;
			height: 200px;
			margin: 0em 0em 1em 0em;
			overflow-y: scroll;
		}
		.slider.slider-horizontal {
			width: 60%;
			margin-left: 1em;
			margin-right: 1em;

		}
		.slider-handle{
			height: 30px;
			width: 30px;
			top: -5px;
		}

		legend.scheduler-border {
			width:inherit; /* Or auto */
			padding:0 10px; /* To give a bit of padding on the left and right */
			border-bottom:none;
		}

		.icon-pos{
			top: 0.3em;
			position: relative;
		 }
		.reboot{
			color:white;
		}
		.reboot:hover{
			color: orange;
		}

		.fa-sync:hover {
			color: #666666;
		}

		.clickForRefresh {
			text-align: center;
			color: gray;
			cursor: pointer;
			margin-top: 5em;
		}

		.clickForRefresh:hover {
			color: darkgray;
		}

		.filetree-container {
			position: relative;
		}

		.coverimage-container {
			width: 80%;
			height:15%;
			margin-left: 1em;
			margin-right: 1em;
		}

		.indexing-progress {
			width: 100%;
			height: 100%;
			position: absolute;
			top: 0;
			left: 0;
			opacity: 0.7;
			display: none;
		}

		.refreshAction{
			text-align: right;
			font-size: 0.8em;
		}

		.refreshAction:hover{
			cursor: pointer;
			color: darkgray;
		}

		.overlay {
			z-index: 9;
			opacity: 0.8;
			background: #1a1919;
			height: 200px;
			display: none;
			width: 100%;
		}

		#SubTabContent.tab-content {
			display: flex;
		}

		#SubTabContent.tab-content > .tab-pane {
			display: block; /* undo "display: none;" */
			visibility: hidden;
			margin-right: -100%;
			width: 100%;
		}

		#SubTabContent.tab-content > .active {
			visibility: visible;
		}

		/* IOS display fix */
		select {
			-webkit-appearance: none;
			-moz-appearance: none;
			appearance: none;
			background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAAAAADhgtq/AAAACXBIWXMAAC4jAAAuIwF4pT92AAAAR0lEQVR4nGP5z4ADsOCSGOoyC+NRabjMQqjQQrgUTCYeIrQQyEI3DSyFJIHkApAUkgSy21B0oLo6fiGSBKp/kCUGU4hSRQYAYg0Rw+gGlUQAAAAASUVORK5CYII=') no-repeat;
			background-position: center right;
		}
		.fas{
			padding-right: 0.25em;
		}
	</style>
</head>
<body>
<nav class="navbar navbar-expand-sm bg-primary navbar-dark">
	<div class="col-md-12">
	<a class="float-left navbar-brand">
		<img src="/logo"
			 width="35" height="35" class="d-inline-block align-top" alt=""/>
		ESPuino
	</a>
	<a class="reboot float-right nav-link" href="/restart"><i class="fas fa-redo"></i> <span data-i18n="restart">Restart</span></a>
	<a class="reboot float-right nav-link" href="/shutdown"><i class="fas fa-power-off"></i> <span data-i18n="shutdown">Shutdown</span></a>
	<a class="reboot float-right nav-link" href="/log"><i class="fas fa-book"></i> <span data-i18n="log">Log</span></a>
	<a class="reboot float-right nav-link" href="/info"><i class="fas fa-info"></i> <span data-i18n="info">Infos</span></a>
	<select class="form-control float-right" style="width:auto;padding-right:25px;" id="langSel" name="langSel">
		<option value="de">de</option>
		<option value="en">en</option>
	</select>
	</div>
</nav>
<br/>
	<nav>
		<div class="container nav nav-tabs" id="nav-tab" role="tablist">
			<a class="nav-item nav-link" id="nav-control-tab" data-toggle="tab" href="#nav-control" role="tab" aria-controls="nav-control" aria-selected="false"><i class="fas fa-gamepad"></i><span class=".d-sm-none .d-md-block" data-i18n="nav.control">Control</span></a>
			<a class="nav-item nav-link active" id="nav-rfid-tab" data-toggle="tab" href="#nav-rfid" role="tab" aria-controls="nav-rfid" aria-selected="true"><i class="fas fa-dot-circle"></i><span data-i18n="nav.rfid">RFID</span></a>
			<a class="nav-item nav-link" id="nav-wifi-tab" data-toggle="tab" href="#nav-wifi" role="tab" aria-controls="nav-wifi" aria-selected="false"><i class="fas fa-wifi"></i><span class=".d-sm-none .d-md-block"><span data-i18n="nav.wifi">WiFi</span></a>
			%SHOW_MQTT_TAB%
			%SHOW_FTP_TAB%
			<a class="nav-item nav-link" id="nav-general-tab" data-toggle="tab" href="#nav-general" role="tab" aria-controls="nav-general" aria-selected="false"><i class="fas fa-sliders-h"></i><span data-i18n="nav.general">General</span></a>
			<a class="nav-item nav-link" id="nav-tools-tab" data-toggle="tab" href="#nav-tools" role="tab" aria-controls="nav-tools" aria-selected="false"><i class="fas fa-wrench"></i><span data-i18n="nav.tools">Tools</span></a>
			<a class="nav-item nav-link" id="nav-forum-tab" data-toggle="tab" href="#nav-forum" role="tab" aria-controls="nav-forum" aria-selected="false"><i class="fas fa-comment"></i><span class=".d-sm-none .d-md-block"><span data-i18n="nav.forum">Forum</span></span></a>
		</div>
	</nav>
<br>
<div class="tab-content" id="nav-tabContent">
	<div class="tab-pane fade" id="nav-wifi" role="tabpanel" aria-labelledby="nav-wifi-tab">
		<div class="container" id="wifiConfig">
			<form action="#wifiConfig" method="POST" onsubmit="wifiConfig('wifiConfig'); return false">
				<div class="form-group col-md-12">
					<legend data-i18n="wifi.title">WiFi-settings</legend>
					<label for="ssid" data-i18n="[prepend]wifi.ssid.title">:</label>
					<input type="text" class="form-control" id="ssid" data-i18n="[placeholder]wifi.ssid.placeholder" name="ssid" required>
					<div class="invalid-feedback" data-i18n="wifi.ssid.validation"></div>
					<label for="pwd" data-i18n="[prepend]wifi.password.title">:</label>
					<input type="password" class="form-control" id="pwd" name="pwd" data-i18n="[placeholder]wifi.password.placeholder" required>
					<label for="hostname" data-i18n="[prepend]wifi.hostname.title">:</label>
					<input type="text" class="form-control" id="hostname" data-i18n="[placeholder]wifi.hostname.placeholder" name="hostname"
						   value="%HOSTNAME%" pattern="^[^-\.]{2,32}" required>
				</div>
				<br>
				<div class="text-center">
				<button type="reset" class="btn btn-secondary" data-i18n="reset"></button>&nbsp
				<button type="submit" class="btn btn-primary" data-i18n="submit"></button>
				</div>
			</form>
		</div>
	</div>
	<div class="tab-pane fade" id="nav-control" role="tabpanel" aria-labelledby="nav-control-tab">
		<div class="container" id="navControl">
				<div class="form-group col-md-12">
					<legend data-i18n="control.title"></legend>
					<div class="form-group col-md-12">
						<img src="/cover" class="coverimage-container" id="coverimg" alt="">
					</div>
					<div class="buttons">
						<button type="button" class="btn btn-default btn-lg" id="nav-btn-first" onclick="sendControl(173)" data-i18n="[title]control.first">
							<span class="fas fa-fast-backward"></span>
						</button>
						<button type="button" class="btn btn-default btn-lg" id="nav-btn-prev" onclick="sendControl(171)" data-i18n="[title]control.prev">
							<span class="fas fa-backward"></span>
						</button>
						<button type="button" class="btn btn-default btn-lg" id="nav-btn-play" onclick="sendControl(170)" data-i18n="[title]control.playpause">
							<i id="ico-play-pause" class="fas fa-lg fa-play"></i>
						</button>
						<button type="button" class="btn btn-default btn-lg" id="nav-btn-next" onclick="sendControl(172)" data-i18n="[title]control.forward">
							<span class="fas fa-forward"></span>
						</button>
						<button type="button" class="btn btn-default btn-lg" id="nav-btn-last" onclick="sendControl(174)" data-i18n="[title]control.last">
							<span class="fas fa-fast-forward"></span>
						</button>
					</div>
				</div>
				<br>
				<div class="form-group col-md-12">
					<legend data-i18n="control.volume"></legend>
						<button type="button" class="btn btn-default btn-lg" onclick="sendControl(177)" data-i18n="[title]control.voldown">
							<span class="fas fa-volume-down"></span>
						</button>
						</i><input data-provide="slider" type="number" data-slider-min="1" data-slider-max="21" min="1" max="21" class="form-control" id="setVolume"
							data-slider-value="%CURRENT_VOLUME%" value="%CURRENT_VOLUME%" onchange="sendVolume(this.value)">
						<button type="button" class="btn btn-default btn-lg" onclick="sendControl(176)" data-i18n="[title]control.volup">
							<span class="fas fa-volume-up"></span>
						</button>
				</div>
				<br/>
				<div class="form-group col-md-12">
					<legend data-i18n="control.current"></legend>
					<div id="track"></div>
				</div>
		</div>
	</div>
	<div class="tab-pane fade show active" id="nav-rfid" role="tabpanel" aria-labelledby="nav-rfid-tab">
		<div class="container" id="filetreeContainer">
			<fieldset>
				<legend data-i18n="files.title">Files</legend>
				<div class="filetree-container">
				<div id="filebrowser">
					<div class="filetree demo" id="explorerTree"></div>
				</div>
				<div>
					<form id="explorerUploadForm" method="POST" enctype="multipart/form-data" action="/explorer">
						<div class="input-group">
							<span class="form-control" id="uploaded_file_text"></span>&nbsp
							<span class="input-group-btn">
								<span class="btn btn-secondary" onclick="let input = $(this).parent().find('input[type=file]')[0]; input.webkitdirectory=false; input.click();" data-i18n="[title]files.files.desc;files.files.title">Files</span>&nbsp
								<span class="btn btn-secondary" onclick="let input = $(this).parent().find('input[type=file]')[0]; input.webkitdirectory=true; input.click();" data-i18n="[title]files.directory.desc;files.directory.title">Directory</span>&nbsp
								<span class="btn btn-primary" onclick="$(this).parent().find('input[type=file]').submit();" data-i18n="[title]files.upload.desc;files.upload.title">Upload</span>
								<input name="uploaded_file" id ="uploaded_file" onchange="$(this).parent().parent().find('.form-control').html($(this).val().split(/[\\|/]/).pop());" style="display: none;" type="file" multiple>
							</span>
						</div>
					</form>
					<br>
					<div class="progress">
						<div id="explorerUploadProgress" class="progress-bar" role="progressbar" ></div>
					</div>
				</div>
				<br>
				</div>
			</fieldset>
		</div>
		<div class="container" id="rfidMusicTags">
			<fieldset>
				<legend data-i18n="files.rfid.title">RFID-Assignments</legend>
			<form action="#rfidMusicTags" method="POST" onsubmit="rfidAssign('rfidMusicTags'); return false">
				<div class="form-group col-md-12">
					<label for="rfidIdMusic" data-i18n="files.rfid.idNumber">RFID-number (12 digits)</label>
					<input type="text" class="form-control" id="rfidIdMusic" maxlength="12" pattern="[0-9]{12}"
						   placeholder="%RFID_TAG_ID%" name="rfidIdMusic" required>
					<br>
					<ul class="nav nav-tabs" id="SubTab" role="tablist">
						<li class="nav-item">
							<a class="nav-link active" id="rfid-music-tab" data-toggle="tab" href="#rfidmusic" role="tab"><i class="fas fa-music"></i> <span data-i18n="files.rfid.music">Music</span></a>
						</li>
						<li class="nav-item">
							<a class="nav-link" id="rfid-mod-tab" data-toggle="tab" href="#rfidmod" role="tab"><i class="fas fa-cog"></i> <span data-i18n="files.rfid.modification">modification</span></a>
						</li>
					</ul>
					<div class="tab-content" id="SubTabContent">
						<div class="tab-pane show active" id="rfidmusic" role="tabpanel">
							<br>
							<label for="fileOrUrl" data-i18n="files.rfid.fileurl.title"></label>
							<input type="text" class="form-control" id="fileOrUrl" maxlength="255" pattern="^[^\^#]+$" name="fileOrUrl" data-i18n="[placeholder]files.rfid.fileurl.placeholder" required>
							<label for="playMode" data-i18n="files.rfid.playmode.title"></label>
							<select class="form-control" id="playMode" name="playMode">
								<option class="placeholder" disabled selected value="" data-i18n="files.rfid.playmode.placeholder"></option>
								<option class="option-file" value="1" data-i18n="files.rfid.playmode.mode.1"></option>
								<option class="option-file" value="2" data-i18n="files.rfid.playmode.mode.2"></option>
								<option class="option-folder" value="12" data-i18n="files.rfid.playmode.mode.12"></option>
								<option class="option-file-and-folder" value="3" data-i18n="files.rfid.playmode.mode.3"></option>
								<option class="option-file-and-folder" value="4" data-i18n="files.rfid.playmode.mode.4"></option>
								<option class="option-folder" value="5" data-i18n="files.rfid.playmode.mode.5"></option>
								<option class="option-folder" value="6" data-i18n="files.rfid.playmode.mode.6"></option>
								<option class="option-folder" value="7" data-i18n="files.rfid.playmode.mode.7"></option>
								<option class="option-folder" value="9" data-i18n="files.rfid.playmode.mode.9"></option>
								<option class="option-folder" value="13" data-i18n="files.rfid.playmode.mode.13"></option>
								<option class="option-stream" value="8" data-i18n="files.rfid.playmode.mode.8"></option>
								<option class="option-stream" value="11" data-i18n="files.rfid.playmode.mode.11"></option>
							</select>
						</div>
						<div class="tab-pane " id="rfidmod" role="tabpanel">
							<label for="modId" data-i18n="files.rfid.mod.title"></label>
							<select class="form-control" id="modId" name="modId">
								<option class="placeholder" disabled selected value="" data-i18n="files.rfid.mod.placeholder"></option>
								<option value="100" data-i18n="files.rfid.mod.cmd.100"></option>
								<option value="179" data-i18n="files.rfid.mod.cmd.179"></option>
								<option value="101" data-i18n="files.rfid.mod.cmd.101"></option>
								<option value="102" data-i18n="files.rfid.mod.cmd.102"></option>
								<option value="103" data-i18n="files.rfid.mod.cmd.103"></option>
								<option value="104" data-i18n="files.rfid.mod.cmd.104"></option>
								<option value="105" data-i18n="files.rfid.mod.cmd.105"></option>
								<option value="106" data-i18n="files.rfid.mod.cmd.106"></option>
								<option value="107" data-i18n="files.rfid.mod.cmd.107"></option>
								<option value="110" data-i18n="files.rfid.mod.cmd.110"></option>
								<option value="111" data-i18n="files.rfid.mod.cmd.111"></option>
								<option value="120" data-i18n="files.rfid.mod.cmd.120"></option>
								<option value="130" data-i18n="files.rfid.mod.cmd.130"></option>
								<option value="140" data-i18n="files.rfid.mod.cmd.140"></option>
								<option value="141" data-i18n="files.rfid.mod.cmd.141"></option>
								<option value="150" data-i18n="files.rfid.mod.cmd.150"></option>
								<option value="0" data-i18n="files.rfid.mod.cmd.0"></option>
								<option value="170" data-i18n="files.rfid.mod.cmd.170"></option>
								<option value="171" data-i18n="files.rfid.mod.cmd.171"></option>
								<option value="172" data-i18n="files.rfid.mod.cmd.172"></option>
								<option value="173" data-i18n="files.rfid.mod.cmd.173"></option>
								<option value="174" data-i18n="files.rfid.mod.cmd.174"></option>
								<option value="180" data-i18n="files.rfid.mod.cmd.180"></option>
								<option value="181" data-i18n="files.rfid.mod.cmd.181"></option>
							</select>
						</div>
					</div>
				</div>
				<br>
				<div class="text-center">
				<button type="reset" class="btn btn-secondary" data-i18n="reset">Reset</button>&nbsp
				<button type="submit" class="btn btn-primary" data-i18n="submit">Submit</button>
				</div>
			</form>
			</fieldset>
		</div>
		<br />
	</div>
	<div class="tab-pane fade" id="nav-mqtt" role="tabpanel" aria-labelledby="nav-mqtt-tab">
		<div class="container" id="mqttConfig">

			<form class="needs-validation" action="#mqttConfig" method="POST"
				  onsubmit="mqttSettings('mqttConfig'); return false">
				<div class="form-check col-md-12">
					<legend data-i18n="mqtt.title"></legend>
					<input class="form-check-input" type="checkbox" value="1" id="mqttEnable" name="mqttEnable" %MQTT_ENABLE%>
					<label class="form-check-label" for="mqttEnable" data-i18n="mqtt.enable"></label>
				</div>
				<div class="form-group my-2 col-md-12">
					<label for="mqttClientId" data-i18n="[prepend]mqtt.clientId.title">:</label>
					<input type="text" class="form-control" id="mqttClientId" minlength="7" maxlength="%MQTT_CLIENTID_LENGTH%"
						  data-i18n="[placeholder]mqtt.clientId.placeholder" name="mqttClientId" value="%MQTT_CLIENTID%">
					<label for="mqttServer" data-i18n="[prepend]mqtt.server.title">:</label>
					<input type="text" class="form-control" id="mqttServer" minlength="7" maxlength="%MQTT_SERVER_LENGTH%"
						   data-i18n="[placeholder]mqtt.server.placeholder" name="mqttServer" value="%MQTT_SERVER%">
					<label for="mqttUser" data-i18n="[prepend]mqtt.user.title">:</label>
					<input type="text" class="form-control" id="mqttUser" maxlength="%MQTT_USER_LENGTH%"
						   data-i18n="[placeholder]mqtt.user.placeholder" name="mqttUser" value="%MQTT_USER%">
					<label for="mqttPwd" data-i18n="[prepend]mqtt.pwd.title">:</label>
					<input type="password" class="form-control" id="mqttPwd" maxlength="%MQTT_PWD_LENGTH%"
						   data-i18n="[placeholder]mqtt.pwd.placeholder" name="mqttPwd" value="%MQTT_PWD%">
					<label for="mqttPort" data-i18n="[prepend]mqtt.port.title">:</label>
					<input type="number" class="form-control" id="mqttPort" min="1" max="65535"
							data-i18n="[placeholder]mqtt.port.placeholder" name="mqttPort" value="%MQTT_PORT%" required>
				</div>
				<br>
				<div class="text-center">
				<button type="reset" class="btn btn-secondary" data-i18n="reset"></button>&nbsp
				<button type="submit" class="btn btn-primary" data-i18n="submit"></button>
				</div>
			</form>
		</div>
	</div>
	<div class="tab-pane fade" id="nav-ftp" role="tabpanel" aria-labelledby="nav-ftp-tab">
		<div class="container" id="ftpConfig">

			<form action="#ftpConfig" method="POST" onsubmit="ftpSettings('ftpConfig'); return false">
				<div class="form-group col-md-12">
					<legend data-i18n="ftp.title"></legend>
					<label for="ftpUser" data-i18n="[prepend]ftp.user.title">:</label>
					<input type="text" class="form-control" id="ftpUser" maxlength="%FTP_USER_LENGTH%"
						data-i18n="[placeholder]ftp.user.placeholder" name="ftpUser" value="%FTP_USER%" required>
					<label for="pwd" data-i18n="[prepend]ftp.pwd.title">:</label>
					<input type="password" class="form-control" id="ftpPwd" maxlength="%FTP_PWD_LENGTH%" data-i18n="[placeholder]ftp.pwd.placeholder"
						   name="ftpPwd" value="%FTP_PWD%" required>
				</div>
				<br>
				<div class="text-center">
				<button type="reset" class="btn btn-secondary" data-i18n="reset"></button>&nbsp
				<button type="submit" class="btn btn-primary" data-i18n="submit"></button>
				</div>
			</form>
		</div>
		<div class="container" id="ftpStart">
			<div class="form-group col-md-12">
				<legend data-i18n="ftp.start.title"></legend>
				<div data-i18n="ftp.start.desc"></div>
				<br>
				<div class="text-center">
					<button type="button" class="btn btn-primary" onclick="ftpStart()" data-i18n="ftp.start.button"></button>
				</div>
			</div>
		</div>
	</div>
	<div class="tab-pane fade" id="nav-general" role="tabpanel" aria-labelledby="nav-general-tab">
		<div class="container" id="generalConfig">

			<form action="#generalConfig" method="POST" onsubmit="genSettings('generalConfig'); return false">
					<div class="form-group col-md-12">
					<fieldset>
							<legend class="w-auto" data-i18n="general.volume.title"></legend>
					<label for="initialVolume" data-i18n="[prepend]general.volume.restart">:</label>
						<div class="text-center">
					<i class="fas fa-volume-down fa-2x .icon-pos"></i> <input data-provide="slider" type="number" data-slider-min="1" data-slider-max="21" min="1" max="21" class="form-control" id="initialVolume" name="initialVolume"
						data-slider-value="%INIT_VOLUME%"  value="%INIT_VOLUME%" required>  <i class="fas fa-volume-up fa-2x .icon-pos"></i></div>
						<br>
					<label for="maxVolumeSpeaker" data-i18n="[prepend]general.volume.speakerMax">:</label>
						<div class="text-center">
					 <i class="fas fa-volume-down fa-2x .icon-pos"></i>   <input data-provide="slider" type="number" data-slider-min="1" data-slider-max="21" min="1" max="21" class="form-control" id="maxVolumeSpeaker" name="maxVolumeSpeaker"
						data-slider-value="%MAX_VOLUME_SPEAKER%"  value="%MAX_VOLUME_SPEAKER%" required>  <i class="fas fa-volume-up fa-2x .icon-pos"></i>
						</div>
						<br>
					<label for="maxVolumeHeadphone" data-i18n="[prepend]general.volume.headphoneMax">:</label>
						<div class="text-center">
					<i class="fas fa-volume-down fa-2x .icon-pos"></i> <input data-provide="slider" type="number" data-slider-min="1" data-slider-max="21" min="1" max="21" class="form-control" id="maxVolumeHeadphone" name="maxVolumeHeadphone"
						 data-slider-value="%MAX_VOLUME_HEADPHONE%" value="%MAX_VOLUME_HEADPHONE%" required>  <i class="fas fa-volume-up fa-2x .icon-pos"></i>
						</div>
				</fieldset>
				</div>
				<br>
				<div class="form-group col-md-12">
					<fieldset >
						<legend class="w-auto" data-i18n="general.neopixel.title"></legend>
					<label for="initBrightness" data-i18n="[prepend]general.neopixel.restart">:</label>
						<div class="text-center">
							<i class="far fa-sun fa-2x .icon-pos"></i>
						<input data-provide="slider" type="number" data-slider-min="0" data-slider-max="254" min="0" max="254" class="form-control" id="initBrightness" name="initBrightness"
							   data-slider-value="%INIT_LED_BRIGHTNESS%"  value="%INIT_LED_BRIGHTNESS%" required><i class="fas fa-sun fa-2x .icon-pos"></i>
						</div>

					<label for="nightBrightness" data-i18n="[prepend]general.neopixel.nightmode">:</label>
						<div class="text-center">
						<i class="far fa-sun fa-2x .icon-pos"></i><input data-provide="slider" type="number" data-slider-min="0" data-slider-max="255" min="0" max="255" class="form-control" id="nightBrightness" name="nightBrightness" data-slider-value="%NIGHT_LED_BRIGHTNESS%" value="%NIGHT_LED_BRIGHTNESS%" required><i class="fas fa-sun fa-2x .icon-pos"></i>
						</div>
					</fieldset>
				</div>
				<br>
				<div class="form-group col-md-12">
					<fieldset>
						<legend data-i18n="general.sleep.title"></legend>

						<label for="inactivityTime" data-i18n="general.sleep.incativity"></label>
						<div class="text-center"><i class="fas fa-hourglass-start fa-2x .icon-pos"></i> <input type="number" data-provide="slider" data-slider-min="0" data-slider-max="30" min="1" max="120" class="form-control" id="inactivityTime" name="inactivityTime"
						 data-slider-value="%MAX_INACTIVITY%"  value="%MAX_INACTIVITY%" required><i class="fas fa-hourglass-end fa-2x .icon-pos"></i></div>
					</fieldset>
				</div>
				<br>

				<div class="form-group col-md-12">
					<fieldset>
						<legend data-i18n="general.battery.title"></legend>
					<div data-i18n="general.battery.desc"></div>
						<br>
					<label for="warningLowVoltage" data-i18n="[prepend]general.battery.lowWarning">:</label>
						<div class="text-center">
						<i class="fas fa-battery-quarter fa-2x .icon-pos"></i> <input  data-provide="slider"  data-slider-step="0.1" data-slider-min="2.5" data-slider-max="5.0"  min="2.5" max="5.0" type="text" class="form-control" id="warningLowVoltage" name="warningLowVoltage"
						data-slider-value="%WARNING_LOW_VOLTAGE%" value="%WARNING_LOW_VOLTAGE%" pattern="^\d{1,2}(\.\d{1,3})?" required> <i class="fas fa-battery-three-quarters fa-2x .icon-pos" fa-2x .icon-pos></i>
						</div>
					<br>
					<label for="voltageIndicatorLow" data-i18n="[prepend]general.battery.lowCritical">:</label>
						<div class="text-center">
						<i class="fas fa-battery-quarter fa-2x .icon-pos"></i> <input data-provide="slider" min="2.5" data-slider-step="0.1" data-slider-min="2.5" data-slider-max="5.0" max="5.0" type="text" class="form-control" id="voltageIndicatorLow" name="voltageIndicatorLow"
						  data-slider-value="%VOLTAGE_INDICATOR_LOW%"  value="%VOLTAGE_INDICATOR_LOW%" pattern="^\d{1,2}(\.\d{1,3})?" required> <i class="fas fa-battery-three-quarters fa-2x .icon-pos" fa-2x .icon-pos></i>
						</div>
						<br>
						<label for="voltageIndicatorHigh" data-i18n="[prepend]general.battery.high">:</label>

							<div class="text-center">
								<i class="fas fa-battery-quarter fa-2x .icon-pos"></i><input data-provide="slider" data-slider-step="0.1"  data-slider-min="2.0" data-slider-max="5.0" min="2.0" max="5.0" type="text" class="form-control" id="voltageIndicatorHigh" name="voltageIndicatorHigh"
						   data-slider-value="%VOLTAGE_INDICATOR_HIGH%"  value="%VOLTAGE_INDICATOR_HIGH%" pattern="^\d{1,2}(\.\d{1,3})?" required> <i class="fas fa-battery-three-quarters fa-2x .icon-pos" fa-2x .icon-pos></i>
						</div>

						<br>
					<label for="voltageCheckInterval" data-i18n="[prepend]general.battery.measureInterval">:</label>
						<div class="text-center"><i class="fas fa-hourglass-start fa-2x .icon-pos"></i>
							<input data-provide="slider" data-slider-min="1" data-slider-max="60" type="number" min="1" max="60" class="form-control" id="voltageCheckInterval"
								   data-slider-value="%BATTERY_CHECK_INTERVAL%"  name="voltageCheckInterval" value="%BATTERY_CHECK_INTERVAL%" required><i class="fas fa-hourglass-end fa-2x .icon-pos"></i>
					</div>

					</fieldset>
				</div>
<br>
				<div class="text-center">
				<button type="reset" class="btn btn-secondary" data-i18n="reset"></button>&nbsp
				<button type="submit" class="btn btn-primary" data-i18n="submit"></button>
				</div>
			</form>
		</div>
		<br />
	</div>
	<div class="tab-pane fade" id="nav-tools" role="tabpanel" aria-labelledby="nav-tools-tab">
		<div class="container" id="eraseNvs">
			<legend data-i18n="tools.nvserase.title"></legend>
			<form action="/rfidnvserase" enctype="multipart/form-data" method="GET">
				<div class="form-group" data-i18n="[html]tools.nvserase.desc">
					<p></p>
				</div>
				<button type="submit" class="btn btn-primary" data-i18n="tools.nvserase.button"></button>
			</form>
		</div>
		<br />
		<br />
		<div class="container" id="importNvs">
			<legend data-i18n="tools.nvsimport.title"></legend>
			<form action="/upload" enctype="multipart/form-data" method="POST">
				<div class="form-group">
					<label for="nvsUpload" data-i18n="tools.nvsimport.desc"></label>
					<input type="file" class="form-control-file" id="nvsUpload" name="nvsUpload" accept=".txt">
				</div>
				<button type="submit" class="btn btn-primary" data-i18n="submit"></button>
			</form>
		</div>
		<br />
		<br />
		<div class="container" id="httpUpdate">
			<legend data-i18n="tools.fwupdate.title"></legend>
			<form action="/update" enctype="multipart/form-data" method="POST">
				<div class="form-group">
					<label for="firmwareUpload" data-i18n="tools.fwupdate.desc"></label>
					<input type="file" class="form-control-file" id="firmwareUpload" name="firmwareUpload" accept=".bin">
				</div>
				<button type="submit" class="btn btn-primary" data-i18n="submit"></button>
			</form>
		</div>
	</div>
	<br />
	<br />
	<div class="tab-pane fade" id="nav-forum" role="tabpanel" aria-labelledby="nav-forum-tab">
		<div class="container" id="forum">
			<legend data-i18n="forum.title"></legend>
			<p data-i18n="[html]forum.desc"></p>
		</div>
	</div>
</div>
<script type="text/javascript">
	var DEBUG = false;
	var lastIdclicked = '';
	var ActiveSubTab = 'rfid-music-tab';
	var host = $(location).attr('hostname');
	var language = navigator.language || navigator.userLanguage;
	var localize;

	/* show active / selected tab */
	$('#SubTab.nav-tabs a').on('shown.bs.tab', function (e) {
		ActiveSubTab = $(e.target).attr('id');
		console.log ( ActiveSubTab);
		if (ActiveSubTab == 'rfid-music-tab') {
			document.getElementById("fileOrUrl").required = true;
		} else {
			document.getElementById("fileOrUrl").required = false;
		}
});

	if (DEBUG) {
		host = "192.168.178.114";
	}

	toastr.options = {
		"closeButton": false,
		"debug": false,
		"newestOnTop": false,
		"progressBar": false,
		"positionClass": "toast-top-right",
		"onclick": null,
		"showDuration": "300",
		"hideDuration": "1000",
		"timeOut": "5000",
		"extendedTimeOut": "1000",
		"showEasing": "swing",
		"hideEasing": "linear",
		"showMethod": "fadeIn",
		"hideMethod": "fadeOut",
		"preventDuplicates": true,
		"preventOpenDuplicates": true
	};
    
    i18next.use(i18nextHttpBackend).init({
        backend: {
            loadPath: "/locales/{{lng}}.json"
        },
		load: 'languageOnly',
        debug: true,
        fallbackLng: 'en',
		returnObjects: true,
    }, (err, t) => {	
		localize = locI18next.init(i18next);
		localize('body');

		// change the language if we found it in the local storage
		const lang = localStorage.getItem("language");
		if(lang === null){
			i18next.changeLanguage(language.split("-")[0]);
		} else {
			i18next.changeLanguage(lang);
		}
	});

	i18next.on('languageChanged', (lng) => {
		document.querySelector('#langSel').value = lng;

		if(localize) {
			localize('body');
		}
	});

	document.querySelector('#langSel').addEventListener('change', (e) => {
		const lang = e.target.value;
		console.log(lang);
		if(lang !== i18next.language){
			localStorage.setItem("language", lang);
			i18next.changeLanguage(lang);
		}
	});

	function postRendering(event, data) {
		Object.keys(data.instance._model.data).forEach(function (key, index) {

			var cur = data.instance.get_node(data.instance._model.data[key]);
			var lastFolder = cur['id'].split('/').filter(function (el) {
				return el.trim().length > 0;
			}).pop();
			if ((/\.(mp3|MP3|ogg|wav|WAV|OGG|wma|WMA|acc|ACC|flac|FLAC|m4a|M4A)$/i).test(lastFolder)) {
				data.instance.set_type(data.instance._model.data[key], 'audio');
			} else
			if ((/\.(png|PNG|jpg|JPG|jpeg|JPEG|bmp|BMP|gif|GIF)$/i).test(lastFolder)) {
				data.instance.set_type(data.instance._model.data[key], 'image');
				data.instance.disable_node(data.instance._model.data[key]);
			} else {
			 if (data.instance._model.data[key]['type'] == "file") {
					data.instance.disable_node(data.instance._model.data[key]);
				}
			}
			data.instance.rename_node(data.instance._model.data[key], lastFolder);
		});
	}


	/* File Explorer functions begin*/
	var lastSelectedNodePath = "";

	$('#explorerTree').on('select_node.jstree', function (e, data) {

		$('input[name=fileOrUrl]').val(data.node.data.path);

		if (ActiveSubTab !== 'rfid-music-tab') {
			$('#SubTab.nav-tabs a[id="rfid-music-tab"]').tab('show');
		}

		if (data.node.type == "folder") {
			$('.option-folder').show();
			$('.option-file').hide();
			$('#playMode option').removeAttr('selected').filter('[value=3]').attr('selected', true);
		}

		if (data.node.type == "audio") {
			$('.option-file').show();
			$('.option-folder').hide();
			$('#playMode option').removeAttr('selected').filter('[value=1]').attr('selected', true);
		}

		if(lastSelectedNodePath != data.node.data.path) {
			if (data.node.data.directory) {

				var ref = $('#explorerTree').jstree(true),
					sel = ref.get_selected();
				if(!sel.length) { return false; }
				sel = sel[0];
				var children = $("#explorerTree").jstree("get_children_dom",sel);
				/* refresh only, when there is no child -> possible not yet updated */
				if(children.length < 1){
					refreshNode(sel);
				}

			}
		 lastSelectedNodePath = data.node.data.path;
		}


	});

	function doRest(path, callback, obj) {
		obj.url      = path;
		obj.dataType = "json";
		obj.contentType= "application/json;charset=IBM437",
		obj.scriptCharset= "IBM437",
		obj.success  = function(data, textStatus, jqXHR) {
			if (callback) {
				callback(data);
			}
		};
		obj.error    = function(jqXHR, textStatus, errorThrown) {
			console.log("AJAX error");
			/*debugger; */
		};
		jQuery.ajax(obj);
	} /* doRest */

	function getData(path, callback) {
		doRest(path, callback, {
			method   : "GET"
		});
	} /* getData */

	function deleteData(path, callback, _data) {
		doRest(path, callback, {
			method   : "DELETE",
			data: _data
		});
	} /* deleteData */

	function patchData(path, callback, _data) {
		doRest(path, callback, {
			method   : "PATCH",
			data: _data
		});
	} /* patchData */

	function postData(path, callback, _data) {
		doRest(path, callback, {
			method   : "POST",
			data: _data
		});
	} /* postData */


	function putData(path, callback, _data) {
		doRest(path, callback, {
			method   : "PUT",
			data: _data
		});
	} /* putData */


	/* File Upload */
	$('#explorerUploadForm').submit(function(e){
		e.preventDefault();
		console.log("Upload!");
		var data = new FormData(this);

		var ref = $('#explorerTree').jstree(true),
			sel = ref.get_selected(),
			path = "/";
		if(!sel.length) { alert(i18next.t("files.upload.selectFolder")); return false; }
		if(!document.getElementById('uploaded_file').files.length > 0) { alert(i18next.t("files.upload.selectFile")); return false; }
		sel = sel[0];
		selectedNode = ref.get_node(sel);
		if(selectedNode.data.directory){
			path = selectedNode.data.path
		} else {
			/* remap sel to parent folder */
			sel = ref.get_node(ref.get_parent(sel));
			path = parentNode.data.path;
			console.log("Parent path: " + path);
		}

		const startTime = new Date().getTime();
		let bytesTotal = 0;
		$.ajax({
			url: '/explorer?path=' + path,
			type: 'POST',
			data: data,
			contentType: false,
			processData:false,
			xhr: function() {
				var xhr = new window.XMLHttpRequest();

				xhr.upload.addEventListener("progress", function(evt) {
				  if (evt.lengthComputable) {
					const now = new Date().getTime();
					const percent = parseInt(evt.loaded * 100 / evt.total);
					const elapsed = (now - startTime) / 1000;
					bytesTotal = evt.total;

					let progressText = i18next.t("files.upload.timeCalc");
					if(elapsed){
						const bps = evt.loaded / elapsed;
						const kbps = bps / 1024;
						const remaining = Math.round((evt.total - evt.loaded) / bps);

						const data = {
							percent: percent,
							remaining: {
								unit: (remaining>60) ? i18next.t("files.upload.minutes", {count: Math.round(remaining/60)}) : i18next.t("files.upload.seconds"),
								value: (remaining>60) ? Math.round(remaining/60) : ((remaining > 2) ? remaining : i18next.t("files.upload.fewSec"))
							},
							speed: kbps.toFixed(2)
						}
						progressText = i18next.t("files.upload.progress", data);
						console.log("Percent: " + percent + "%% " + kbps.toFixed(2) + " KB/s");
					}
					$("#explorerUploadProgress").css('width', percent+"%").text(progressText);
				  }
				}, false);

				return xhr;
			},
			success: function(data, textStatus, jqXHR) {
				const now = new Date().getTime();
				const elapsed = (now - startTime) / 1000;

				let transData = {
					elapsed: "00:00",
					speed: "0,00"
				};
				if(elapsed){
					const bps = bytesTotal / elapsed;
					const kbps = bps / 1024;

					const date = new Date(null);
					date.setSeconds(elapsed);
					const timeText = date.toISOString().substr(11, 8);

					transData = { elapsed: timeText, speed: kbps.toFixed(2) };
				}
				console.log("Upload success (" + transData.elapsed + ", " + transData.speed + " KB/s): " + textStatus);
				const progressText = i18next.t("files.upload.success", transData);
				$("#explorerUploadProgress").text(progressText);
				document.getElementById('uploaded_file').value = '';
				document.getElementById('uploaded_file_text').innerHTML = '';

				getData("/explorer?path=" + path, function(data) {
					/* We now have data! */
					deleteChildrenNodes(sel);
					addFileDirectory(sel, data);
					ref.open_node(sel);
				});

			},
			error: function(request, status, error) {
				console.log("Upload ERROR!");
				$("#explorerUploadProgress").text(i18next.t("files.upload.error") +": " + status);
				toastr.error(i18next.t("files.upload.error") + ": " + status);
			}
		});
	});

	/* File Delete */
	function handleDeleteData(nodeId) {
		var ref = $('#explorerTree').jstree(true);
		var node = ref.get_node(nodeId);
		console.log("call delete request: " + node.data.path);
		deleteData("/explorer?path=" + encodeURIComponent(node.data.path));
	}

	function fileNameSort( a, b ) {
		if ( a.dir && !b.dir ) {
			return -1
		}
		if ( !a.dir && b.dir ) {
			return 1
		}
		if ( a.name < b.name ){
			return -1;
		}
		if ( a.name > b.name ){
			return 1;
		}
		return 0;
	}

	function createChild(nodeId, data) {
		var ref = $('#explorerTree').jstree(true);
		var node = ref.get_node(nodeId);
		var parentNodePath = node.data.path;
		/* In case of root node remove leading '/' to avoid '//' */
		if(parentNodePath == "/"){
			parentNodePath = "";
		}
		var child = {
			text: data.name,
			type: getType(data),
			data: {
				path: parentNodePath + "/" + data.name,
				directory: data.dir
			}
		};

		return child;

	}

	function deleteChildrenNodes(nodeId) {
		var ref = $('#explorerTree').jstree(true);
		var children = $("#explorerTree").jstree("get_children_dom",nodeId);
		for(var i=0;i<children.length;i++)
		{
			ref.delete_node(children[i].id);
		}

	}

	function refreshNode(nodeId) {

		var ref = $('#explorerTree').jstree(true);

		var node = ref.get_node(nodeId);

		getData("/explorer?path=" + encodeURIComponent(node.data.path), function(data) {
			/* We now have data! */

			deleteChildrenNodes(nodeId);
			addFileDirectory(nodeId, data);
			ref.open_node(nodeId);

		});


	}

	function getType(data) {
		var type = "";

		if(data.dir) {
			type = "folder";
		} else if ((/\.(mp3|MP3|ogg|wav|WAV|OGG|wma|WMA|acc|ACC|m4a|M4A|flac|FLAC)$/i).test(data.name)) {
			type = "audio";
		} else if ((/\.(png|PNG|jpg|JPG|jpeg|JPEG|bmp|BMP|gif|GIF)$/i).test(data.name)) {
			type = "image";
		} else {
			type = "file";
		}

		return type;
	}


	function addFileDirectory(parent, data) {

		data.sort( fileNameSort );
		var ref = $('#explorerTree').jstree(true);

		for (var i=0; i<data.length; i++) {
			console.log("Create Node");
			ref.create_node(parent, createChild(parent, data[i]));
		}
	} /* addFileDirectory */

	function buildFileSystemTree(path) {

		$('#explorerTree').jstree({
				"core" : {
						"check_callback" : true,
						'force_text' : true,
						'strings' : { "Loading ..." : () => i18next.t("files.loading") },
						"themes" : { "stripes" : true },
						'data' : {	text: '/',
									state: {
										opened: true
									},
									type: 'folder',
									children: [],
									data: {
										path: '/',
										directory: true
								}}
					},
					'types': {
						'folder': {
							'icon': "fa fa-folder"
						},
						'file': {
							'icon': "fa fa-file"
						},
						'audio': {
							'icon': "fa fa-file-audio"
						},
						'image': {
							'icon': "fa fa-file-image"
						},
						'default': {
							'icon': "fa fa-folder"
						}
					},
				plugins: ["contextmenu", "themes", "types"],
				contextmenu: {
					items: function(nodeId) {
						var ref = $('#explorerTree').jstree(true);
						var node = ref.get_node(nodeId);
						var items = {};


						if (node.data.directory) {
							items.createDir = {
								label: () => i18next.t("files.context.newFolder"),
								action: function(x) {
									var childNode = ref.create_node(nodeId, {text: () => i18next.t("files.context.newFolder"), type: "folder"});
									if(childNode) {
										ref.edit(childNode, null, function(childNode, status){
											putData("/explorer?path=" + encodeURIComponent(node.data.path) + "/" + encodeURIComponent(childNode.text));
											refreshNode(nodeId);
										});
									}
								}
							};
						}

						/* Play */
						items.play = {
							label: () => i18next.t("files.context.play"),
							action: function(x) {
								var playMode = 1;
								if (node.data.directory) {
									playMode = 5;
								} else {
									if ((/\.(m3u|M3U)$/i).test(node.data.path)) {
										playMode = 11;
									}
								}
								postData("/exploreraudio?path=" + encodeURIComponent(node.data.path) + "&playmode=" + playMode);
							}
						};

						/* Refresh */
						items.refresh = {
							label: () => i18next.t("files.context.refresh"),
							action: function(x) {
								refreshNode(nodeId);
							}
						};

						/* Delete */
						items.delete = {
							label: () => i18next.t("files.context.delete"),
							action: function(x) {
								handleDeleteData(nodeId);
								refreshNode(ref.get_parent(nodeId));
							}
						};

						/* Rename */
						items.rename = {
							label: () => i18next.t("files.context.rename"),
							action: function(x) {
								var srcPath = node.data.path;
								ref.edit(nodeId, null, function(node, status){
									node.data.path = node.data.path.substring(0,node.data.path.lastIndexOf("/")+1) + node.text;
									patchData("/explorer?srcpath=" + encodeURIComponent(srcPath) + "&dstpath=" + encodeURIComponent(node.data.path));
									refreshNode(ref.get_parent(nodeId));
								});
							}
						};

						/* Download */
						if (!node.data.directory) {
							items.download = {
								label: () => i18next.t("files.context.download"),
								action: function(x) {
									uri = "/explorerdownload?path=" + encodeURIComponent(node.data.path);
									console.log("download file: " + node.data.path);
									var anchor = document.createElement('a');
									anchor.href = uri;
									anchor.target = '_blank';
									anchor.download = node.data.path;
									anchor.click();
									document.body.removeChild(document.body.lastElementChild);
								}
							}
						};

						return items;
					}
				}
			});

		if (path.length == 0) {
			return;
		}
		getData("/explorer?path=/", function(data) {
			/* We now have data! */
			$('#explorerTree').jstree(true).settings.core.data.children = [];

			data.sort( fileNameSort );


			for (var i=0; i<data.length; i++) {
				var newChild = {
					text: data[i].name,
					type: getType(data[i]),
					data: {
						path: "/" + data[i].name,
						directory: data[i].dir
					},
					children: []
				};
				$('#explorerTree').jstree(true).settings.core.data.children.push(newChild);
			}

			$("#explorerTree").jstree(true).refresh();


		});
	} /* buildFileSystemTree */

	/* File Explorer functions end */

	var socket = undefined;
	var tm;
	var volumeSlider = new Slider("#setVolume");
	document.getElementById('setVolume').remove();

	function connect() {
		socket = new WebSocket("ws://" + host + "/ws");

		socket.onopen = function () {
			setInterval(ping, 15000);
			getTrack();
			getCoverimage();
		};

		socket.onclose = function (e) {
			console.log('Socket is closed. Reconnect will be attempted in 5 seconds.', e.reason);
			socket = null;
			setTimeout(function () {
				connect();
			}, 5000);
		};

		socket.onerror = function (err) {
			console.error('Socket encountered error: ', err.message, 'Closing socket');
		};

		socket.onmessage = function(event) {
		  console.log(event.data);
		  var socketMsg = JSON.parse(event.data);
		  if (socketMsg.rfidId != null) {
			  document.getElementById('rfidIdMusic').value = socketMsg.rfidId;
			  toastr.info(i18next.t("toast.rfidDetect", { rfidId: socketMsg.rfidId }));
			  $("#rfidIdMusic").effect("highlight", {color:"#abf5af"}, 3000);
		  } if ("status" in socketMsg) {
			  if (socketMsg.status == "ok") {
				  toastr.success(i18next.t("toast.success"));
			  }
		  } if ("pong" in socketMsg) {
			if (socketMsg.pong == 'pong') {
				  pong();
			  }
			} if ("volume" in socketMsg) {
				volumeSlider.setValue(parseInt(socketMsg.volume));
			} if ("trackinfo" in socketMsg) {
				document.getElementById('track').innerHTML = socketMsg.trackinfo.name;

				var btnTrackPlayPause = document.getElementById('nav-btn-play');
				if (socketMsg.trackinfo.pausePlay) {
					btnTrackPlayPause.innerHTML = '<i id="ico-play-pause" class="fas fa-lg fa-play"></i>';
				} else {
					btnTrackPlayPause.innerHTML = '<i id="ico-play-pause" class="fas fa-lg fa-pause"></i>';
				}

				var btnTrackFirst = document.getElementById('nav-btn-first');
				var btnTrackPrev = document.getElementById('nav-btn-prev');
				if (socketMsg.trackinfo.currentTrackNumber <= 1) {
					btnTrackFirst.classList.add("disabled");
					btnTrackPrev.classList.add("disabled");
				} else {
					btnTrackFirst.classList.remove("disabled");
					btnTrackPrev.classList.remove("disabled");
				}
				var btnTrackLast = document.getElementById('nav-btn-last');
				var btnTrackNext = document.getElementById('nav-btn-next');
				if (socketMsg.trackinfo.currentTrackNumber >= socketMsg.trackinfo.numberOfTracks) {
					btnTrackLast.classList.add("disabled");
					btnTrackNext.classList.add("disabled");
				} else {
					btnTrackLast.classList.remove("disabled");
					btnTrackNext.classList.remove("disabled");
				}
			} if ("coverimg" in socketMsg) {
				document.getElementById('coverimg').src = "/cover?" + new Date().getTime();
		  }
	  };
	}


	function ping() {
		var myObj = {
			"ping": {
				ping: 'ping'
			}
		};
		var myJSON = JSON.stringify(myObj);
		socket.send(myJSON);
		tm = setTimeout(function () {
			toastr.warning(i18next.t("toast.conlost"));
		}, 5000);
	}

	function pong() {
		clearTimeout(tm);
	}

	function getTrack() {
		var myObj = {
			"trackinfo": {
				trackinfo: 'trackinfo'
			}
		};
		var myJSON = JSON.stringify(myObj);
		socket.send(myJSON);
	}

	function getCoverimage() {
		var myObj = {
			"coverimg": {
				coverimg: 'coverimg'
			}
		};
		var myJSON = JSON.stringify(myObj);
		socket.send(myJSON);
	}


	function genSettings(clickedId) {
		lastIdclicked = clickedId;
		var myObj = {
			"general": {
				iVol: document.getElementById('initialVolume').value,
				mVolSpeaker: document.getElementById('maxVolumeSpeaker').value,
				mVolHeadphone: document.getElementById('maxVolumeHeadphone').value,
				iBright: document.getElementById('initBrightness').value,
				nBright: document.getElementById('nightBrightness').value,
				iTime: document.getElementById('inactivityTime').value,
				vWarning: document.getElementById('warningLowVoltage').value,
				vIndLow: document.getElementById('voltageIndicatorLow').value,
				vIndHi: document.getElementById('voltageIndicatorHigh').value,
				vInt: document.getElementById('voltageCheckInterval').value
			}
		};
		var myJSON = JSON.stringify(myObj);
		socket.send(myJSON);
	}

	function ftpSettings(clickedId) {
		lastIdclicked = clickedId;
		var myObj = {
			"ftp": {
				ftpUser: document.getElementById('ftpUser').value,
				ftpPwd: document.getElementById('ftpPwd').value
			}
		};
		var myJSON = JSON.stringify(myObj);
		socket.send(myJSON);
	}

	function ftpStart() {
		var myObj = {
			"ftpStatus": {
				start: 1
			}
		};
		var myJSON = JSON.stringify(myObj);
		socket.send(myJSON);
	}

	function mqttSettings(clickedId) {
		lastIdclicked = clickedId;
		var val;
		if (document.getElementById('mqttEnable').checked) {
			val = document.getElementById('mqttEnable').value;
		} else {
			val = 0;
		}
		var myObj = {
			"mqtt": {
				mqttEnable: val,
				mqttClientId: document.getElementById('mqttClientId').value,
				mqttServer: document.getElementById('mqttServer').value,
				mqttUser: document.getElementById('mqttUser').value,
				mqttPwd: document.getElementById('mqttPwd').value,
				mqttPort: document.getElementById('mqttPort').value
			}
		};
		var myJSON = JSON.stringify(myObj);
		socket.send(myJSON);
	}

	function removeTrSlash(str) {
		if (str.substr(-1) === '/') {
			return str.substr(0, str.length - 1);
		}
		return str;
	}

	function rfidAssign(clickedId) {
		lastIdclicked = clickedId;
		if (ActiveSubTab == 'rfid-music-tab') {
			var myObj = {
				"rfidAssign": {
					rfidIdMusic: document.getElementById('rfidIdMusic').value,
					fileOrUrl: removeTrSlash(document.getElementById('fileOrUrl').value),
					playMode: document.getElementById('playMode').value
				}
			};
		} else {
			var myObj = {
				"rfidMod": {
					rfidIdMod: document.getElementById('rfidIdMusic').value,
					modId: document.getElementById('modId').value
				}
			};
		}
		var myJSON = JSON.stringify(myObj);
		socket.send(myJSON);
	}

	function wifiConfig(clickedId) {
		lastIdclicked = clickedId;
		var myObj = {
			"wifiConfig": {
				ssid: document.getElementById('ssid').value,
				pwd: document.getElementById('pwd').value,
				hostname: document.getElementById('hostname').value
			}
		};
		var myJSON = JSON.stringify(myObj);
		socket.send(myJSON);
	}
	function sendControl(cmd) {
		var myObj = {
			"controls": {
				action: cmd
			}
		};
		var myJSON = JSON.stringify(myObj);
		socket.send(myJSON);
	}
	function sendVolume(vol) {
		var myObj = {
			"controls": {
				set_volume: vol
			}
		};
		var myJSON = JSON.stringify(myObj);
		socket.send(myJSON);
	}

	$(document).ready(function () {
		connect();
		buildFileSystemTree("/");

		console.log(parseInt(document.getElementById('warningLowVoltage').value));
		$(function () {
			$('[data-toggle="tooltip"]').tooltip();
		});
	});
</script>
</body>
</html>